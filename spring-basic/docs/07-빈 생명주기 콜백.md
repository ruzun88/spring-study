# 빈 생명주기 콜백

## 빈 생명주기 콜백 시작

데이터베이스 커넥션 풀이나 소켓 처럼 필요한 연결을 미리 해 두고, 앱 종료 시점에 연결을을 진행하려면, 객체 초기화와 종료가 중요함

- 스프링 빈은 다음과 같은 라이프사이클을 가진다.
  1. 객체 생성
  2. 의존 관계 주입 => 이 과정이 끝나야 필요한 데이터를 사용할 수 있는 준비가 완료됨
- 스프링 빈의 이벤트 라이프 사이클
  1. 스프링 컨테이너 생성
  2. 스프링 빈 생성
  3. 의존관계 주입
  4. 초기화 콜백: 빈 생성 후, 빈의 의존 관계 주입 완료 후 호출
  5. 사용
  6. 소멸전 콜백: 빈 소멸 직전에 호출
  7. 스프링 종료

* 스프링의 콜백 지원 방법
  * 인터페이스
  * 설정 정보에 초기화 메서드, 종료 메서드 지정
  * @PostConstruct, @PreDestroy 어노테이션

## 인터페이스 - InitializingBean, DisposableBean

InitializingBean : afterPropertiesSet 함수로 initalize

DisposableBean: destroy 함수로 종료

### 단점

- 스프링 전용 인터페이스
- 초기화, 소멸 메서드 이름 변경 불가
- 내가 코드를 고칠 수 없는 external library에 적용할 수 없다.

### 결론

- 이 방법은 잘 사용하지 않는다. 지금은 더 좋은 방법들이 있다!

## 빈 등록 초기화, 소멸 메서드

설정 정보에 @Bean(initMethod = "init", destroyMethod = "close") 등으로 초기화, 소멸 메서드 지정이 가능하다.

### 장점

- 메서드 이름이 자유롭다
- 스프링 빈이 스프링 코드에 의존하는 것이 없다
- 코드가 아니라, 설정 정보를 사용하기 때문에, 코드를 고칠 수 없는 외부 라이브러리에도 초기화, 종료 메서드를 적용할 수 있다. (가장 큰 장점)

### destroyMethod 특징

- 라이브러리들은 대부분, close / shutdown 이름으로 종료 메서드를 사용한다.
- destoryMethod를 특별히 지정하지 않으면 위의 두 이름으로 된 메서드를 종료 시 자동 호출한다.
- 쓰고싶지 않다면, destroyMethod="" (공백) 을 입력하면 된다.

## 어노테이션을 활용 (이 방법이 best)

@PostConstruct, @PreDestroy 어노테이션을 활용한다.

해당 annotation은 javax.annotaion.xxx 이므로, 스프링 기술이 아니라, 자바 표준이므로, 다른 컨테이너에서도 잘 동작 함

### 단점

- 외부 라이브러리는 적용하지 못한다.
- 따라서, 외부 라이브러리 초기화/종료를 위해서는 바로 위에 있는 @Bean 기능을 사용한다.
