# Bean Scope

## 빈 스코프란?

빈이 존재 할 수 있는 범위

1. **싱글톤** : 기본 스코프, 스프링 컨테이너 시작과 종료까지 유지됨
2. **프로토타입** : 스프링 컨테이너가 빈 생성, 의존관계 주입, 초기화 까지는 함. 거기까지 만 관여하고, 종료 메서드는 호출하지 않는다.
3. 웹 관련 스코프
   1. **sequest**: 웹 요청이 들어오고 나갈때 까지만 유지
   2. session: 웹 세션이 생성되고 종료될때까지 유지
   3. application: 웹의 서블릿 컨텍스트 범위

스코프는 @Scope 어노테이션을 통해 지정할 수 있다.



## 프로토타입 스코프

**프로토타입 스코프**를 스프링 컨테이너에 조회하면 스프링 컨테이너는 **항상 새로운 인스턴스를 생성**하여 반환한다.

싱글턴은 같은 인스턴스를 보장한다.

프로토타입 빈을 관리할 책임은 프로토타입 빈을 받은 클라이언트에게 있다. 그래서 Spring container에서 사용하는 @PreDestory 등의 메서드는 동작하지 않는다.



## 프로토타입 스코프 - 싱글톤 빈과 함께 사용시 문제점

- 싱글턴 빈 안에 프로토타입 빈이 있다면, 그 프로토타입 빈은 한번만 생성된다!



## Provider를 통한 문제 해결

* 가장 간단한 방법은 그냥 ApplicationContext으로부터 받는 것... 좋은 방법은 아니다. 복잡하거든

### ObjectFactory, ObjectProvider

* 두개 모두 비슷한 것이다. ObjectProvider는 ObjectFactory를 상속받아서 쓰고 있다. 편의기능이 추가된 정도

### Provider

java 표준인 Provider를 사용 할 수 있다. 기능도 단순하여 단위 테스트를 만들거나 mock 코드를 만들기도 쉽다.

별도의 라이브러리가 필요하다는 것이 단점

스프링이 아닌 컨테이너에서도 사용할 수 있다는 것은 장점



### 프로토타입 빈을 언제 사용할까?

- 새로운 객체가 필요할 때. but, 실무에서 사용하는 경우는 드물다.
- 순환참조의 문제가 발생할 때 사용할 수 있음.



## 웹 스코프

- 웹 환경에서만 동작
- 스코프의 종료시점까지 스프링이 관리해 줌 (프로토타입과 다른 점)



### Request Scope

Web 서비스에서 동시에 여러 요청이 들어온 경우, 각각의 요청에 대해 로깅을 하는 것이 필요하다. 이때 request scope를 효과적으로 사용할 수 있다.

하지만, request scope를 사용할 때는, provider가 필요하다. 스프링 서비스가 시작 할 때, request가 없기 때문에 request scope의 bean이 존재하지 않는다. 따라서, 스프링 서비스가 뜨지 않는 것이다.
